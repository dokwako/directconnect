{% extends 'base.html' %}
{% block content %}
<div class="max-w-6xl mx-auto p-6">
  <h2 class="text-3xl font-semibold mb-6">Assign Orders to Employees</h2>

  {% if messages %}
    <div class="mb-4 space-y-2">
      {% for message in messages %}
        <div class="p-3 rounded {{ message.tags }} {% if message.tags == 'error' %}bg-red-100 text-red-800{% elif message.tags == 'success' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded mb-6">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Pickup Location</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Destination</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Assign To</th>
        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Action</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      {% for order in orders %}
      <tr>
        <td class="px-4 py-2 whitespace-nowrap">{{ order.id }}</td>
        <td class="px-4 py-2 whitespace-nowrap">{{ order.location }}</td>
        <td class="px-4 py-2 whitespace-nowrap">{{ order.destination }}</td>
        <td class="px-4 py-2 whitespace-nowrap">{{ order.customer.get_full_name|default:order.customer.username }}</td>
        <td class="px-4 py-2 whitespace-nowrap">
          <form method="post" class="flex items-center space-x-2">
            {% csrf_token %}
            <input type="hidden" name="order_id" value="{{ order.id }}">
            <select name="employee_id" class="border border-gray-300 rounded px-2 py-1 text-sm" required>
              <option value="" disabled selected>Select Employee</option>
              {% for employee in employees %}
                <option value="{{ employee.id }}">{{ employee.get_full_name|default:employee.username }}</option>
              {% endfor %}
            </select>
            <button type="submit" formaction="{% url 'adminpanel:assign_order' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow text-sm font-semibold">Assign</button>
          </form>
        </td>
        <td class="px-4 py-2 whitespace-nowrap"></td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="px-4 py-2 text-center text-gray-500">No pending orders to assign.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
