{% extends 'base.html' %}
{% block content %}
<h2 class="text-2xl mb-4 font-semibold">My Assigned Deliveries</h2>

<table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded">
  <thead class="bg-gray-50">
    <tr>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Pickup Location</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Destination Location</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Customer Name</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Customer Contact</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Order Details</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Current Status</th>
      <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
    </tr>
  </thead>
  <tbody class="bg-white divide-y divide-gray-200">
    {% for order in orders %}
    <tr>
      <td class="px-4 py-2 whitespace-nowrap">{{ order.id }}</td>
      <td class="px-4 py-2 whitespace-nowrap">{{ order.location }}</td>
      <td class="px-4 py-2 whitespace-nowrap">{{ order.destination }}</td>
      <td class="px-4 py-2 whitespace-nowrap">{{ order.customer.get_full_name|default:order.customer.username }}</td>
      <td class="px-4 py-2 whitespace-nowrap">{{ order.customer.email }}</td>
      <td class="px-4 py-2 whitespace-nowrap">{{ order.details|default:"-" }}</td>
      <td class="px-4 py-2 whitespace-nowrap">
        {% if order.status == 'assigned' %}
          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Assigned</span>
        {% elif order.status == 'in_transit' %}
          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">In Transit</span>
        {% elif order.status == 'delivered' %}
          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Delivered</span>
        {% else %}
          <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">{{ order.status }}</span>
        {% endif %}
      </td>
      <td class="px-4 py-2 whitespace-nowrap">
        {% if order.status == 'assigned' %}
          <form method="post" action="{% url 'employee:start_delivery' %}">
            {% csrf_token %}
            <input type="hidden" name="order_id" value="{{ order.id }}">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-semibold">Start Delivery</button>
          </form>
        {% elif order.status == 'in_transit' %}
          <form method="post" action="{% url 'employee:complete_delivery' %}">
            {% csrf_token %}
            <input type="hidden" name="order_id" value="{{ order.id }}">
            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm font-semibold">Mark as Delivered</button>
          </form>
        {% else %}
          <span class="text-gray-500 text-sm">No actions</span>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="8" class="px-4 py-2 text-center text-gray-500">No assigned deliveries found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
